# PIXELO - Social Flow

## Overview
- **목적**: 친구 추가, 친구 공간 방문, 성향 비교 등 소셜 기능
- **시작점**: 하단 네비게이션 친구 탭
- **종료점**: 친구와의 인터랙션 완료
- **핵심 기능**: 친구 추가, 친구 목록, 공간 방문, 성향 비교

---

## Flow Diagram

### Happy Path (친구 목록 -> 방문/비교)

```
[홈 화면]
    |
    v
(하단 네비 - 친구 탭)
    |
    v
(친구 목록 화면)
- 내 친구 목록
- 친구 요청 알림
    |
    +-- [친구 추가 버튼] --> (친구 추가 플로우)
    |
    +-- [친구 요청 탭] --> (친구 요청 플로우)
    |
    +-- [친구 선택]
            |
            v
        (친구 프로필)
        - 닉네임, 프로필
        - 성향 요약
        - 공간 미리보기
            |
            +-- [공간 방문] --> (친구 공간 보기)
            |                       |
            |                       v
            |                   (친구 공간 뷰)
            |                   - 3D/2D 공간
            |                   - 배치된 오브젝트
            |                       |
            |                       v
            |                   [뒤로가기]
            |
            +-- [성향 비교] --> (비교 화면)
            |                       |
            |                       v
            |                   (7축 비교 그래프)
            |                   - 나 vs 친구
            |                   - 공통점/차이점
            |                       |
            |                       v
            |                   [공유하기] 또는 [닫기]
            |
            +-- [친구 삭제] --> (삭제 확인)
                                    |
                                    v
                                <삭제?>
                                    |
                    +--- Yes -------+------- No ---+
                    |                              |
                    v                              v
                (삭제 완료)                    (취소)
                    |
                    v
                (친구 목록)
                    |
                    v
                [완료]
```

### 친구 추가 플로우

```
(친구 목록 화면)
    |
    v
[친구 추가 버튼]
    |
    v
(친구 추가 화면)
    |
    +-- [닉네임 검색]
    |       |
    |       v
    |   [검색어 입력]
    |       |
    |       v
    |   (검색 결과)
    |       |
    |       +-- 결과 있음 --> (사용자 목록)
    |       |                     |
    |       |                     v
    |       |               [친구 요청 버튼]
    |       |                     |
    |       |                     v
    |       |               (요청 전송 완료)
    |       |               "친구 요청을 보냈어요"
    |       |
    |       +-- 결과 없음 --> "검색 결과가 없어요"
    |
    +-- [링크 공유]
    |       |
    |       v
    |   (내 초대 링크 생성)
    |       |
    |       v
    |   [공유하기]
    |       |
    |       v
    |   (카카오/문자/복사)
    |       |
    |       v
    |   [완료]
    |
    +-- [QR 코드]
            |
            v
        (내 QR 코드 표시)
            |
            v
        [QR 스캔] (친구의 QR)
            |
            v
        (친구 프로필 표시)
            |
            v
        [친구 요청]
            |
            v
        [완료]
```

### 친구 요청 처리 플로우

```
(친구 목록 화면)
    |
    v
[친구 요청 탭] (알림 뱃지)
    |
    v
(받은 요청 목록)
    |
    v
[요청 선택]
    |
    v
(요청자 프로필)
    |
    +-- [수락]
    |       |
    |       v
    |   (친구 추가 완료)
    |   "친구가 되었어요!"
    |       |
    |       v
    |   (친구 목록에 추가)
    |
    +-- [거절]
            |
            v
        (요청 삭제)
        (조용히 삭제, 알림 없음)
```

---

## Alternative Paths

### 초대 링크로 친구 추가 (받는 측)

```
[초대 링크 클릭] (외부)
    |
    v
(앱 실행 / 설치 유도)
    |
    v
<로그인 상태?>
    |
    +-- No --> (로그인 화면)
    |              |
    |              v
    |          [로그인]
    |              |
    +-- Yes -------+
                   |
                   v
               (초대자 프로필)
               "{닉네임}님이 초대했어요"
                   |
                   v
               [친구 추가]
                   |
                   v
               (친구 추가 완료)
               "친구가 되었어요!"
                   |
                   v
               (홈 화면)
```

### 이미 친구인 경우

```
[친구 요청 버튼]
    |
    v
<이미 친구?>
    |
    v
(안내 메시지)
"이미 친구입니다"
    |
    v
[프로필 보기]
```

### 이미 요청 보낸 경우

```
[친구 요청 버튼]
    |
    v
<이미 요청 보냄?>
    |
    v
(안내 메시지)
"이미 요청을 보냈어요"
    |
    v
[요청 취소] 또는 [확인]
```

---

## Error Paths

### 검색 실패

```
[검색어 입력]
    |
    v
<네트워크 오류?>
    |
    v
(에러 메시지)
"검색에 실패했어요. 다시 시도해주세요"
    |
    v
[다시 시도]
```

### 친구 요청 실패

```
[친구 요청 버튼]
    |
    v
<요청 실패?>
    |
    v
(에러 메시지)
"요청을 보내지 못했어요"
    |
    v
[다시 시도]
```

### 차단된 사용자

```
[친구 검색]
    |
    v
(검색 결과)
    |
    v
<차단됨?>
    |
    v
(결과에 표시 안 됨)
```

---

## Screen Details

### 1. 친구 목록 화면

```
+------------------------------------------+
|                                          |
| [<]  친구                         [추가] |
|                                          |
|  [친구 목록]  [받은 요청 (3)]            |
|                                          |
|  +------------------------------------+  |
|  |                                    |  |
|  |  검색                              |  |
|  |  [_____________________________]   |  |
|  |                                    |  |
|  +------------------------------------+  |
|                                          |
|  내 친구 12명                            |
|                                          |
|  +------------------------------------+  |
|  | [프로필]  닉네임1                   |  |
|  |          마지막 접속: 오늘          |  |
|  +------------------------------------+  |
|  | [프로필]  닉네임2                   |  |
|  |          마지막 접속: 어제          |  |
|  +------------------------------------+  |
|  | [프로필]  닉네임3                   |  |
|  |          마지막 접속: 3일 전        |  |
|  +------------------------------------+  |
|  | ...                                |  |
|  +------------------------------------+  |
|                                          |
+-------+-------+-------+-------+-------+  |
| 홈    | 질문  | 공간  | 친구* | 설정  |  |
+-------+-------+-------+-------+-------+--+
```

**정렬 순서**:
1. 최근 접속 순
2. 가나다 순 (선택 가능)

---

### 2. 친구 프로필 화면

```
+------------------------------------------+
|                                          |
| [<]                              [...]   |
|                                          |
|           +---------------+              |
|           |               |              |
|           |  [프로필 이미지]|              |
|           |               |              |
|           +---------------+              |
|              닉네임                       |
|                                          |
|  +------------------------------------+  |
|  |  성향 요약                          |  |
|  |                                    |  |
|  |  내향적 | 루틴형 | 미니멀            |  |
|  |  #조용한편 #계획적 #심플함           |  |
|  +------------------------------------+  |
|                                          |
|  +------------------------------------+  |
|  |  공간 미리보기                      |  |
|  |  +------------------------------+  |  |
|  |  |     [공간 썸네일]             |  |  |
|  |  |     시즌 1: 나의 방           |  |  |
|  |  |     완성도 78%               |  |  |
|  |  +------------------------------+  |  |
|  +------------------------------------+  |
|                                          |
|   +----------------+  +----------------+ |
|   |   공간 방문     |  |   성향 비교    | |
|   +----------------+  +----------------+ |
|                                          |
+------------------------------------------+
```

**더보기 메뉴 ([...])**:
- 친구 삭제
- 차단하기
- 신고하기

---

### 3. 친구 공간 방문 화면

```
+------------------------------------------+
|                                          |
| [<]  {닉네임}의 공간             [공유]  |
|                                          |
|  +------------------------------------+  |
|  |                                    |  |
|  |                                    |  |
|  |       [친구의 공간 3D/2D 뷰]        |  |
|  |                                    |  |
|  |       +---------+                  |  |
|  |       |  침대   |                  |  |
|  |       +---------+                  |  |
|  |                   +------+         |  |
|  |       +-----+     | 책상 |         |  |
|  |       |조명 |     +------+         |  |
|  |       +-----+                      |  |
|  |                                    |  |
|  +------------------------------------+  |
|                                          |
|  +------------------------------------+  |
|  |  시즌 1: 나의 방                    |  |
|  |  완성도: 78%  [========--]         |  |
|  |  오브젝트: 15/20                    |  |
|  +------------------------------------+  |
|                                          |
|   +----------------------------------+   |
|   |         성향 비교하기             |   |
|   +----------------------------------+   |
|                                          |
+------------------------------------------+
```

**인터랙션**:
- 핀치 줌, 드래그로 탐색
- 오브젝트 탭 시 정보 표시
- 편집 불가 (보기 전용)

---

### 4. 성향 비교 화면

```
+------------------------------------------+
|                                          |
| [<]  성향 비교                   [공유]  |
|                                          |
|      나             vs        {닉네임}   |
|  [프로필]                     [프로필]   |
|                                          |
|  +------------------------------------+  |
|  |                                    |  |
|  |          [레이더 차트]              |  |
|  |                                    |  |
|  |      7축 비교 시각화               |  |
|  |      (나: 파란색, 친구: 주황색)     |  |
|  |                                    |  |
|  +------------------------------------+  |
|                                          |
|  +------------------------------------+  |
|  |  비슷한 점                          |  |
|  |  - 둘 다 내향적인 편이에요          |  |
|  |  - 루틴을 중요하게 생각해요         |  |
|  +------------------------------------+  |
|                                          |
|  +------------------------------------+  |
|  |  다른 점                           |  |
|  |  - 당신은 미니멀, 친구는 맥시멀     |  |
|  |  - 당신은 안정 추구, 친구는 모험가  |  |
|  +------------------------------------+  |
|                                          |
|  궁합 점수: 72%                          |
|  "서로 다른 매력이 있는 사이"            |  |
|                                          |
|   +----------------------------------+   |
|   |         비교 카드 공유            |   |
|   +----------------------------------+   |
|                                          |
+------------------------------------------+
```

---

### 5. 친구 추가 화면

```
+------------------------------------------+
|                                          |
| [<]  친구 추가                           |
|                                          |
|  +------------------------------------+  |
|  |                                    |  |
|  |  닉네임으로 검색                    |  |
|  |  [_____________________________]   |  |
|  |                                    |  |
|  +------------------------------------+  |
|                                          |
|  또는                                    |
|                                          |
|  +------------------------------------+  |
|  |  [링크 아이콘]                      |  |
|  |  초대 링크 공유                     |  |
|  |  친구에게 초대 링크를 보내세요       |  |
|  +------------------------------------+  |
|                                          |
|  +------------------------------------+  |
|  |  [QR 아이콘]                        |  |
|  |  QR 코드                           |  |
|  |  QR 코드로 친구를 추가하세요        |  |
|  +------------------------------------+  |
|                                          |
+------------------------------------------+
```

---

### 6. 받은 요청 화면

```
+------------------------------------------+
|                                          |
| [<]  친구                         [추가] |
|                                          |
|  [친구 목록]  [받은 요청 (3)]            |
|              ================            |
|                                          |
|  받은 요청 3개                           |
|                                          |
|  +------------------------------------+  |
|  | [프로필]  닉네임A                   |  |
|  |          1시간 전                   |  |
|  |          [수락]  [거절]            |  |
|  +------------------------------------+  |
|  | [프로필]  닉네임B                   |  |
|  |          어제                       |  |
|  |          [수락]  [거절]            |  |
|  +------------------------------------+  |
|  | [프로필]  닉네임C                   |  |
|  |          3일 전                     |  |
|  |          [수락]  [거절]            |  |
|  +------------------------------------+  |
|                                          |
+-------+-------+-------+-------+-------+  |
| 홈    | 질문  | 공간  | 친구* | 설정  |  |
+-------+-------+-------+-------+-------+--+
```

---

## Interaction Details

### 친구 검색
- 실시간 검색 (디바운스 500ms)
- 최소 2글자 이상 입력
- 결과 최대 20명 표시
- 프로필 이미지 + 닉네임 표시

### 친구 요청 스와이프
- 왼쪽 스와이프: 거절 (빨간색)
- 오른쪽 스와이프: 수락 (초록색)
- 버튼으로도 동일 액션 가능

### 성향 비교 차트
- 레이더 차트 형태
- 7개 축 시각화
- 탭하면 각 축 상세 설명
- 애니메이션: 축 하나씩 펼쳐짐

### 초대 링크
- 고유 링크 생성 (user ID 기반)
- 유효기간: 7일
- 카카오톡 공유 최적화
- 딥링크 지원

---

## Friend System

### 친구 제한

```
최대 친구 수: 100명
- 100명 초과 시 추가 불가
- "친구가 너무 많아요. 정리 후 추가해주세요"

최대 요청 수: 50개
- 보낸 요청 + 받은 요청 합계
- 초과 시 새 요청 불가
```

### 친구 요청 만료

```
요청 유효기간: 30일
- 30일 후 자동 삭제
- 삭제 시 양쪽 모두 알림 없음
- 재요청 가능
```

### 차단 기능

```
차단 시:
- 상대방 검색 결과에서 제외
- 상대방 친구 목록에서 제거
- 상대방에게 알림 없음
- 상대방이 내 공간 방문 불가
- 상대방이 나에게 요청 불가
```

---

## Comparison System

### 궁합 점수 계산

```
궁합 점수 = 100 - (각 축 차이의 평균)

예시:
나의 점수: [40, 60, 30, 70, 50, 45, 55]
친구 점수: [45, 55, 80, 65, 50, 60, 40]

각 축 차이: [5, 5, 50, 5, 0, 15, 15]
평균 차이: 13.6
궁합 점수: 100 - 13.6 = 86.4%
```

### 궁합 등급

| 점수 범위 | 등급 | 설명 |
|-----------|------|------|
| 90-100% | 찰떡궁합 | "운명적인 만남!" |
| 75-89% | 잘 맞아요 | "서로 잘 통해요" |
| 60-74% | 좋은 사이 | "비슷한 점도, 다른 점도 있어요" |
| 45-59% | 다양한 매력 | "서로 다른 매력이 있는 사이" |
| 30-44% | 흥미로운 조합 | "다름에서 배우는 사이" |
| 0-29% | 정반대 성향 | "완전 다른 세계에서 온 둘" |

---

## UX Considerations

### 소셜 압박 최소화
1. **거절 시 알림 없음**: 조용한 거절
2. **접속 상태 숨김**: 정확한 온라인 상태 미표시
3. **비교 선택적**: 원할 때만 비교
4. **친구 수 비공개**: 다른 사람에게 친구 수 미노출

### 프라이버시
1. **공간 공개 설정**: 친구에게만/전체 공개
2. **프로필 공개 설정**: 검색 가능 여부
3. **차단 기능**: 원치 않는 연락 차단
4. **신고 기능**: 부적절한 사용자 신고

### 연결 촉진
1. **쉬운 초대**: 링크/QR로 간편 초대
2. **재미있는 비교**: 궁합 점수로 흥미 유발
3. **공유 기능**: 비교 카드 SNS 공유
4. **알림**: 친구 요청, 친구의 새 오브젝트 등

---

## States

### 친구 목록 상태

| 상태 | 설명 |
|------|------|
| Loading | 친구 목록 로딩 중 |
| Empty | 친구 없음 |
| Loaded | 친구 목록 표시 |
| Searching | 검색 중 |
| Search Result | 검색 결과 표시 |

### 친구 요청 상태

| 상태 | 설명 |
|------|------|
| None | 관계 없음 |
| Pending Sent | 요청 보낸 상태 |
| Pending Received | 요청 받은 상태 |
| Friend | 친구 상태 |
| Blocked | 차단 상태 |

---

## Analytics Events

| 이벤트 | 시점 | 파라미터 |
|--------|------|----------|
| friends_view | 친구 탭 진입 | friend_count |
| friend_search | 친구 검색 | query |
| friend_request_send | 친구 요청 전송 | method (search/link/qr) |
| friend_request_accept | 친구 요청 수락 | - |
| friend_request_reject | 친구 요청 거절 | - |
| friend_space_visit | 친구 공간 방문 | friend_id |
| friend_compare | 성향 비교 | friend_id, score |
| friend_remove | 친구 삭제 | friend_id |
| friend_block | 친구 차단 | friend_id |
| invite_link_share | 초대 링크 공유 | platform |

---

## Edge Cases

| 상황 | 처리 |
|------|------|
| 친구 0명 | "아직 친구가 없어요" + 친구 추가 안내 |
| 검색 결과 0명 | "검색 결과가 없어요" + 초대 링크 제안 |
| 친구가 탈퇴 | 친구 목록에서 자동 삭제, "(탈퇴한 사용자)" 표시 |
| 친구가 비공개 설정 | 공간 방문 불가, "비공개 공간입니다" |
| 동시에 서로 요청 | 둘 다 자동으로 친구 됨 |

---

## Related Documents

- 메인 플로우: `/design/flows/main-flow.md`
- 공유 카드 플로우: `/design/flows/share-flow.md`
