# PIXELO - Space Management Flow

## Overview
- **목적**: 획득한 오브젝트를 배치하여 나만의 공간을 꾸미고 완성
- **시작점**: 하단 네비게이션 공간 탭 또는 오브젝트 획득 후 배치 안내
- **종료점**: 공간 저장 완료
- **핵심 기능**: 공간 보기, 오브젝트 배치, 편집, 저장

---

## Flow Diagram

### Happy Path (공간 보기 -> 편집 -> 저장)

```
[홈 화면]
    |
    v
(하단 네비 - 공간 탭)
    |
    v
(나의 공간 화면)
- 현재 공간 3D/2D 뷰
- 배치된 오브젝트들
    |
    v
<편집 모드 진입?>
    |
    +-- No --> (공간 구경)
    |              |
    |              +-- [핀치 줌] --> (확대/축소)
    |              +-- [드래그] --> (시점 이동)
    |              +-- [오브젝트 탭] --> (오브젝트 정보)
    |              |
    |              v
    |          [뒤로가기]
    |              |
    |              v
    |          (홈 화면)
    |
    +-- Yes --> [편집 버튼]
                   |
                   v
               (편집 모드)
               - 그리드 표시
               - 하단 인벤토리
                   |
    +--------------+--------------+
    |              |              |
    v              v              v
[새 오브젝트   [기존 오브젝트  [기존 오브젝트
 배치]         이동]          삭제]
    |              |              |
    v              v              v
(인벤토리     (드래그 앤     (삭제 확인
 열기)         드롭)          팝업)
    |              |              |
    v              v              v
[오브젝트     [위치 결정]    <삭제?>
 선택]             |          |
    |              |    +--Yes-+--No--+
    v              |    |             |
(미리보기      |   (삭제 완료)    (취소)
 + 배치)       |        |             |
    |              |        |             |
    v              v        v             |
[위치 결정]--------+--------+-------------+
    |
    v
<저장?>
    |
    +-- [저장 버튼]
    |       |
    |       v
    |   (저장 중)
    |       |
    |       v
    |   <저장 성공?>
    |       |
    |       +-- Yes --> (저장 완료 토스트)
    |       |               |
    |       +-- No --> (에러 메시지)
    |                       |
    |                       v
    |                   [재시도]
    |
    +-- [취소 버튼]
            |
            v
        <변경사항 있음?>
            |
            +-- Yes --> (확인 팝업)
            |           "저장하지 않고 나가시겠어요?"
            |               |
            |    +--[저장]--+--[나가기]--+
            |    |                      |
            |    v                      v
            | (저장)            (변경 취소)
            |    |                      |
            +----+----------------------+
                 |
                 v
             (보기 모드)
                 |
                 v
             [완료]
```

### 오브젝트 획득 후 바로 배치

```
(질문 결과 화면)
    |
    v
[오브젝트 획득]
    |
    v
[공간에 배치하기]
    |
    v
(편집 모드)
- 새 오브젝트 선택된 상태
- 배치 위치 선택 안내
    |
    v
[위치 탭/드래그]
    |
    v
(배치 미리보기)
    |
    v
[확인]
    |
    v
(배치 완료 + 자동 저장)
    |
    v
(보기 모드)
    |
    v
[완료]
```

---

## Alternative Paths

### 인벤토리에서 배치

```
(편집 모드)
    |
    v
[인벤토리 버튼]
    |
    v
(인벤토리 바텀시트)
- 보유 오브젝트 목록
- 배치됨/미배치 상태
    |
    v
[미배치 오브젝트 탭]
    |
    v
(오브젝트 상세)
- 이미지
- 이름
- 획득 조건
    |
    v
[배치하기]
    |
    v
(배치 모드)
- 오브젝트가 손가락 따라다님
    |
    v
[원하는 위치에 놓기]
    |
    v
<유효한 위치?>
    |
    +-- Yes --> (배치 완료)
    |
    +-- No --> (경고 진동 + 빨간 표시)
                   |
                   v
               [다른 위치로]
```

### 오브젝트 회전

```
(편집 모드)
    |
    v
[배치된 오브젝트 탭]
    |
    v
(오브젝트 선택됨)
- 선택 표시 (테두리)
- 액션 버튼 표시
    |
    v
[회전 버튼]
    |
    v
(90도 회전)
    |
    v
[추가 회전] 또는 [완료]
```

### 되돌리기 (Undo)

```
(편집 모드)
    |
    v
[오브젝트 이동/삭제]
    |
    v
(변경 완료)
    |
    v
[Undo 버튼] (3초 내)
    |
    v
(이전 상태로 복원)
```

---

## Error Paths

### 저장 실패

```
[저장 버튼]
    |
    v
(저장 요청)
    |
    v
<네트워크 오류?>
    |
    v
(에러 메시지)
"저장에 실패했어요. 다시 시도해주세요"
    |
    v
[다시 시도]
    |
    v
<재시도 성공?>
    |
    +-- Yes --> (저장 완료)
    |
    +-- No --> "인터넷 연결을 확인해주세요"
                   |
                   v
               (로컬 임시 저장)
                   |
                   v
               "나중에 자동으로 저장됩니다"
```

### 오브젝트 배치 충돌

```
[오브젝트 배치]
    |
    v
<다른 오브젝트와 겹침?>
    |
    v
(충돌 표시 - 빨간색)
    |
    v
[다른 위치로 이동]
    |
    v
<유효한 위치?>
    |
    +-- Yes --> (배치 완료)
    |
    +-- No --> (계속 충돌 표시)
```

---

## Screen Details

### 1. 공간 보기 화면 (기본)

```
+------------------------------------------+
|                                          |
| [<]  나의 공간               [공유] [편집]|
|                                          |
|  +------------------------------------+  |
|  |                                    |  |
|  |                                    |  |
|  |       [나의 공간 3D/2D 뷰]          |  |
|  |                                    |  |
|  |       +---------+                  |  |
|  |       |  침대   |                  |  |
|  |       +---------+                  |  |
|  |                   +------+         |  |
|  |       +-----+     | 책상 |         |  |
|  |       |조명 |     +------+         |  |
|  |       +-----+                      |  |
|  |                                    |  |
|  +------------------------------------+  |
|                                          |
|  +------------------------------------+  |
|  |  시즌 1: 나의 방                    |  |
|  |  완성도: 45%  [====------]         |  |
|  |  오브젝트: 9/20                     |  |
|  +------------------------------------+  |
|                                          |
+-------+-------+-------+-------+-------+  |
| 홈    | 질문  | 공간* | 친구  | 설정  |  |
+-------+-------+-------+-------+-------+--+
```

**인터랙션**:
- 핀치: 줌 인/아웃
- 드래그: 시점 이동
- 오브젝트 탭: 정보 팝업
- 편집 버튼: 편집 모드 진입
- 공유 버튼: 공유 카드 생성으로 이동

---

### 2. 편집 모드 화면

```
+------------------------------------------+
|                                          |
| [X]  편집 모드               [Undo] [저장]|
|                                          |
|  +------------------------------------+  |
|  |  . . . . . . . . . . . . . . . .  |  |
|  |  .                               .  |  |
|  |  .    [나의 공간 + 그리드]        .  |  |
|  |  .                               .  |  |
|  |  .    +---------+                .  |  |
|  |  .    |  침대   |                .  |  |
|  |  .    +---------+                .  |  |
|  |  .                +------+       .  |  |
|  |  .    +-----+     | 책상 |       .  |  |
|  |  .    |조명 |     +------+       .  |  |
|  |  .    +-----+                    .  |  |
|  |  .                               .  |  |
|  +------------------------------------+  |
|                                          |
|  인벤토리                          [전체]|
|  +------+------+------+------+------+   |
|  |      |      |      |      |      |   |
|  | 의자 | 러그 | 화분 | 액자 | ... |   |
|  |      |      |      |      |      |   |
|  +------+------+------+------+------+   |
|  (좌우 스크롤)                           |
|                                          |
+------------------------------------------+
```

**편집 도구**:
- 그리드: 배치 가이드
- Undo: 직전 액션 취소
- 저장: 현재 상태 저장
- X: 편집 모드 종료

---

### 3. 오브젝트 선택 상태

```
+------------------------------------------+
|                                          |
| [X]  편집 모드               [Undo] [저장]|
|                                          |
|  +------------------------------------+  |
|  |                                    |  |
|  |       [========침대========]       |  |
|  |       [    선택 테두리     ]       |  |
|  |                                    |  |
|  |             +------+               |  |
|  |             | 책상 |               |  |
|  |             +------+               |  |
|  |                                    |  |
|  +------------------------------------+  |
|                                          |
|  +------------------------------------+  |
|  |                                    |  |
|  |    [회전]    [이동]    [삭제]      |  |
|  |                                    |  |
|  +------------------------------------+  |
|                                          |
|  인벤토리                          [전체]|
|  +------+------+------+------+------+   |
|  | ...                               |   |
|  +------+------+------+------+------+   |
|                                          |
+------------------------------------------+
```

---

### 4. 인벤토리 전체 화면 (바텀시트)

```
+------------------------------------------+
|                                          |
|  ──────────────────────────────────────  |
|                                          |
|  내 오브젝트 (15/20)              [X]    |
|                                          |
|  [전체] [가구] [조명] [소품] [바닥/벽]   |
|                                          |
|  +------+------+------+------+          |
|  |      |      |      |      |          |
|  | 침대 | 책상 | 의자 | 스탠드|          |
|  | 배치됨| 배치됨| 미배치| 배치됨|          |
|  +------+------+------+------+          |
|  |      |      |      |      |          |
|  | 화분 | 액자 | 러그 | 포스터|          |
|  | 미배치| 미배치| 배치됨| 미배치|          |
|  +------+------+------+------+          |
|  |      |      |      |      |          |
|  | ...  | ...  | ...  | ...  |          |
|  |      |      |      |      |          |
|  +------+------+------+------+          |
|                                          |
+------------------------------------------+
```

---

### 5. 오브젝트 상세 팝업

```
+------------------------------------------+
|                                          |
|  +------------------------------------+  |
|  |                              [X]   |  |
|  |                                    |  |
|  |        [오브젝트 이미지]            |  |
|  |        픽셀 스탠드 조명             |  |
|  |                                    |  |
|  |  "아늑한 분위기를 좋아하는           |  |
|  |   당신을 위한 조명"                 |  |
|  |                                    |  |
|  |  획득일: 2024.01.15               |  |
|  |  획득 조건: 에너지 방향 80+         |  |
|  |                                    |  |
|  |  +------------------------------+  |  |
|  |  |         배치하기              |  |  |
|  |  +------------------------------+  |  |
|  |                                    |  |
|  +------------------------------------+  |
|                                          |
+------------------------------------------+
```

---

### 6. 삭제 확인 팝업

```
+------------------------------------------+
|                                          |
|  +------------------------------------+  |
|  |                                    |  |
|  |        오브젝트 삭제               |  |
|  |                                    |  |
|  |   '픽셀 스탠드 조명'을              |  |
|  |   공간에서 치울까요?               |  |
|  |                                    |  |
|  |   인벤토리에서 다시 배치할 수 있어요  |  |
|  |                                    |  |
|  |  +------------+  +------------+   |  |
|  |  |   취소     |  |   치우기    |   |  |
|  |  +------------+  +------------+   |  |
|  |                                    |  |
|  +------------------------------------+  |
|                                          |
+------------------------------------------+
```

---

## Interaction Details

### 드래그 앤 드롭 배치

```
1. 인벤토리에서 오브젝트 길게 누르기 (500ms)
2. 오브젝트가 손가락 위치로 이동
3. 공간 위로 드래그
4. 유효한 위치: 초록색 가이드
5. 유효하지 않은 위치: 빨간색 + 진동
6. 손가락 떼면 배치 확정
```

### 핀치 줌

```
- 두 손가락 벌리기: 줌 인 (최대 3x)
- 두 손가락 모으기: 줌 아웃 (최소 0.5x)
- 부드러운 이징 적용
```

### 오브젝트 회전

```
- 회전 버튼 탭: 90도 시계방향 회전
- 회전 애니메이션: 0.2초
- 4방향 (0, 90, 180, 270)
```

### 되돌리기 (Undo)

```
- 액션 후 3초간 Undo 버튼 활성화
- 이동, 배치, 삭제, 회전 모두 Undo 가능
- 최대 10개 액션 히스토리
- Undo 시 진동 피드백
```

---

## Space System

### 시즌 1: 나의 방

```
공간 크기: 10x10 그리드
필수 오브젝트:
- 침대 (1개)
- 책상 (1개)
- 조명 (1개)

완성 조건:
- 필수 오브젝트 3개 배치
- 추가 오브젝트 7개 이상 배치
- 총 10개 이상 배치 시 "완성"

완성 보상:
- 시즌 1 완성 뱃지
- 특별 오브젝트 1개
- 공유 카드 특별 테마 해금
```

### 오브젝트 배치 규칙

```
- 그리드 스냅: 1칸 단위
- 겹침 불가: 다른 오브젝트와 중복 배치 불가
- 벽면 오브젝트: 벽 근처에만 배치 (포스터, 액자)
- 바닥 오브젝트: 바닥에만 배치 (러그)
- 일반 오브젝트: 자유 배치
```

### 오브젝트 크기

| 크기 | 그리드 | 예시 |
|------|--------|------|
| 소형 | 1x1 | 화분, 액자, 스탠드 |
| 중형 | 2x1 또는 1x2 | 의자, 선반 |
| 대형 | 2x2 | 책상, 침대 |
| 특대 | 3x2 | 소파 (시즌 2) |

---

## UX Considerations

### 편집 용이성
1. **그리드 스냅**: 정렬 쉽게
2. **Undo 기능**: 실수 복구
3. **미리보기**: 배치 전 확인
4. **충돌 표시**: 겹침 방지

### 성취감 제공
1. **완성도 표시**: 진행 상황 시각화
2. **배치 애니메이션**: 톡톡 떨어지는 효과
3. **완성 축하**: 시즌 완성 시 축하 연출
4. **비포/애프터**: 처음 공간 vs 현재 공간

### 탐색 즐거움
1. **시점 이동**: 자유로운 탐색
2. **줌 인/아웃**: 디테일 확인
3. **오브젝트 정보**: 탭하면 획득 스토리

### 저장 안정성
1. **자동 저장**: 주요 변경 시
2. **로컬 백업**: 네트워크 끊김 대비
3. **변경 확인**: 나가기 전 확인

---

## States

### 공간 화면 상태

| 상태 | 설명 |
|------|------|
| View Mode | 보기 전용, 탐색 가능 |
| Edit Mode | 편집 가능, 그리드 표시 |
| Object Selected | 오브젝트 선택됨, 액션 가능 |
| Placing | 새 오브젝트 배치 중 |
| Saving | 저장 중 |

### 오브젝트 상태

| 상태 | 설명 |
|------|------|
| Placed | 공간에 배치됨 |
| Unplaced | 인벤토리에 있음 |
| Selected | 편집 중 선택됨 |
| Dragging | 드래그 중 |
| Invalid | 유효하지 않은 위치 |

---

## Analytics Events

| 이벤트 | 시점 | 파라미터 |
|--------|------|----------|
| space_view | 공간 화면 진입 | - |
| edit_mode_enter | 편집 모드 진입 | - |
| object_place | 오브젝트 배치 | object_id, position |
| object_move | 오브젝트 이동 | object_id, from, to |
| object_rotate | 오브젝트 회전 | object_id, angle |
| object_remove | 오브젝트 삭제 | object_id |
| space_save | 공간 저장 | object_count |
| undo_action | 되돌리기 | action_type |
| season_complete | 시즌 완성 | season_id |

---

## Edge Cases

| 상황 | 처리 |
|------|------|
| 오브젝트 0개 | 빈 공간 + "질문에 답하고 첫 오브젝트를 획득해보세요" |
| 편집 중 앱 종료 | 로컬 임시 저장, 재진입 시 복구 |
| 대형 오브젝트 공간 부족 | 배치 불가 안내 + 다른 위치 제안 |
| 필수 오브젝트 삭제 | "필수 오브젝트입니다" 안내 (삭제 허용) |
| 시즌 변경 | 기존 공간 아카이브, 새 공간 시작 |

---

## Related Documents

- 메인 플로우: `/design/flows/main-flow.md`
- 질문 응답 플로우: `/design/flows/question-flow.md`
- 공유 카드 플로우: `/design/flows/share-flow.md`
